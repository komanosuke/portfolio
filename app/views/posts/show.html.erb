<main>
    <div class="side-bar pc">
        <%= render 'social_media/sidebar' %>
    </div>

    <div class="contents" id="sns-contents">
        <div id="sns-container">
            <div id="flash"><%= flash[:notice] %><%= flash[:success] %><%= flash[:error] %></div>
            
            
                <div class="posts-show-container">
                    <a href="/users/<%= @post.user.id %>" class="post-name" id="sns-show-post-name">
                        <%= image_tag @post.user.image.url, class:"sns-thumb", alt:"" %>
                        <p><%= @post.user.name %></p>
                        <p><%= @post.user.username %></p>
                    </a>
                    <div class="follow-wrapper" id="show-follow-wrapper">
                        <% if @post.user.id != current_user.id %>
                            <% if @post.user.followed_by?(current_user) %>
                                <% delete_id = @post.user.active_relationships.find_by(follower_id: current_user.id).id %>
                                <%= form_with model:@relationship, url: "/relationships/"+delete_id.to_s, method: :delete do |form| %>
                                    <%= form.hidden_field :url, value: "/posts/"+@post.id.to_s %>
                                    <%= form.submit "フォロー解除", class:"follow-btn" %>
                                <% end %>
                            <% else %>
                                <%= form_with model:@relationship, url: relationships_path, method: :post, scope: :relationship do |form| %>
                                    <%= form.hidden_field :follower_id, value: current_user.id %>
                                    <%= form.hidden_field :followed_id, value: @post.user_id %>
                                    <%= form.hidden_field :url, value: "/posts/"+@post.id.to_s %>
                                    <%= form.submit "フォロー", class:"follow-btn" %>
                                <% end %>
                            <% end %>
                        <% end %>
                    </div>
                </div>
            
            <p class="left"><%= @post.content %></p>
            <% if @post.image.to_s != 'noimage.jpg' %>
                <%= image_tag @post.image.url, class:"sns-post-img sns-show-img", alt:"" %>
            <% end %>

            <% if logged_in? %>
                <% if @post.user != current_user && @post.liked_by?(current_user) %>
                    <p id="delete-like"><%=link_to '❤︎', post_likes_path(@post.id), method: :delete, remote: true %><span> <%= @post.likes.count %></span></p>
                <% elsif @post.user != current_user %>
                    <p id="post-like"><%=link_to '♡', post_likes_path(@post.id), method: :post, remote: true %><span> <%= @post.likes.count %></span></p>
                <% end %>

                <p>コメントしてみる</p>
                <%= form_with model:@comment, url: post_comments_path(@post.id), method: :post do |form| %>
                    <%#= form.hidden_field :user_id, value: current_user %>
                    <%= form.text_area :content, autofocus: true, maxlength: 200, placeholder: "コメントを入力してください", required: true %>
                    <%= form.submit "コメント投稿する", class: "sns-btn" %>
                <% end %>

                <p>コメント投稿 一覧<span> / コメント数: <%= @post.comments.count %></span></p>
                <% if @post.comments.count != 0 %>
                    <% @post.comments.each do |comment| %>
                        <div class="thumb-wrapper comment-wrapper">
                            <a href="/users/<%= comment.user.id %>" class="sns-users-link-comment">
                                <div class="post-name-wrapper">
                                    <%= image_tag comment.user.image.url, class:"sns-thumb", alt:"" %>
                                    <p><%= comment.user.name %></p>
                                    <p><%= comment.user.username %></p>
                                </div>
                            </a>
                            <p class="left link-comment-content"><%= comment.content %></p>
                        </div>
                    <% end %>
                <% else %>
                    <p>コメントはありません。</p>
                <% end %>
            <% end %>
        </div>
    </div>
</main>